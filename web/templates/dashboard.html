<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÔøΩ Global Conservation AI - Real-Time Monitoring</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 1.5rem 2rem;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }
        .header h1 {
            color: #2c3e50;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        .system-status {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .status-indicator {
            background: rgba(46, 204, 113, 0.1);
            padding: 0.4rem 1rem;
            border-radius: 25px;
            border: 1px solid #2ecc71;
            font-size: 0.9rem;
        }
        .main-container {
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }
        .map-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        #madagascar-map {
            width: 100%;
            height: 500px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            margin-top: 1rem;
        }
        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .action-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        .action-card:hover {
            transform: translateY(-5px);
        }
        .action-button {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }
        .emergency-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }
        .emergency-btn:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
            transform: scale(1.02);
        }
        .monitoring-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        .monitoring-btn:hover {
            background: linear-gradient(135deg, #2980b9, #1f618d);
            transform: scale(1.02);
        }
        .scanning-btn {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }
        .scanning-btn:hover {
            background: linear-gradient(135deg, #e67e22, #d35400);
            transform: scale(1.02);
        }
        .query-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        .query-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            margin-bottom: 1rem;
            resize: vertical;
        }
        .query-input:focus {
            outline: none;
            border-color: #9b59b6;
        }
        .query-btn {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .query-btn:hover {
            background: linear-gradient(135deg, #8e44ad, #7d3c98);
            transform: scale(1.02);
        }
        .results-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        .location-info {
            background: #e8f5e8;
            padding: 1rem;
            border-radius: 10px;
            margin-top: 1rem;
            border-left: 4px solid #27ae60;
        }
        .popup-content {
            text-align: center;
            padding: 0.5rem;
        }
        .popup-content h4 {
            margin-bottom: 0.5rem;
            color: #2c3e50;
        }
        .popup-button {
            background: #27ae60;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 0.5rem;
        }
        .popup-button:hover {
            background: #219a52;
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>ÔøΩ Global Conservation AI System</h1>
        <div class="system-status">
            <div class="status-indicator">üü¢ 6/6 APIs Active</div>
            <div class="status-indicator">üìä Real-time Data</div>
            <div class="status-indicator">ü§ñ 6 AI Agents Ready</div>
        </div>
    </header>
    
    <div class="main-container">
        <!-- Real Interactive Map Section -->
        <div class="map-section">
            <h3>üó∫Ô∏è Real Madagascar Map - Click Any Location</h3>
            <p>Click anywhere on Madagascar to analyze conservation status for that specific location</p>
            <div class="location-info" id="location-info" style="display: none;">
                <strong>üìç Selected Location:</strong> <span id="selected-coords"></span><br>
                <strong>üèûÔ∏è Nearest Park:</strong> <span id="nearest-park"></span>
            </div>
            <div id="madagascar-map"></div>
        </div>

        <!-- Action Buttons -->
        <div class="action-grid">
            <div class="action-card">
                <h3>üö® Emergency Response</h3>
                <p>Activate all 6 AI agents for immediate threat assessment and emergency conservation planning.</p>
                <button class="action-button emergency-btn" onclick="triggerEmergencyResponse()">
                    üö® EMERGENCY RESPONSE
                </button>
            </div>

            <div class="action-card">
                <h3>üîç Species Monitoring</h3>
                <p>Start real-time species detection and population monitoring using GBIF and eBird data.</p>
                <button class="action-button monitoring-btn" onclick="startSpeciesMonitoring()">
                    üîç START MONITORING
                </button>
            </div>

            <div class="action-card">
                <h3>‚ö†Ô∏è Threat Scanning</h3>
                <p>Scan for environmental threats using NASA FIRMS fire detection and satellite imagery.</p>
                <button class="action-button scanning-btn" onclick="scanForThreats()">
                    ‚ö†Ô∏è SCAN THREATS
                </button>
            </div>
        </div>

        <!-- Natural Language Query Section -->
        <div class="query-section">
            <h3>üí¨ Ask the Conservation AI</h3>
            <p>Type any conservation question and our AI will analyze real-world data to provide answers</p>
            <textarea 
                class="query-input" 
                id="conservation-query" 
                placeholder="Example: 'Are there any fires threatening lemur populations in Andasibe?' or 'What's the current biodiversity status in Masoala National Park?'"
                rows="3"
            ></textarea>
            <button class="query-btn" onclick="processQuery()">
                ü§ñ Ask Conservation AI
            </button>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="results">
            <h3>üìä Conservation Results</h3>
            <p>Click anywhere on the Madagascar map above or use the action buttons to see real-time conservation analysis</p>
        </div>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // Initialize the map centered on Madagascar
        var map = L.map('madagascar-map').setView([-18.766947, 46.869107], 6);

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        // Global variables to store last selected location
        var lastSelectedLat = null;
        var lastSelectedLng = null;
        var lastSelectedLocation = "Madagascar";

        // Madagascar National Parks with real coordinates
        var nationalParks = [
            {name: "Andasibe-Mantadia National Park", coords: [-18.9333, 48.4167], description: "Home to Indri indri lemurs"},
            {name: "Ranomafana National Park", coords: [-21.2500, 47.4167], description: "Rainforest biodiversity hotspot"},
            {name: "Isalo National Park", coords: [-22.5500, 45.3167], description: "Sandstone formations and endemic species"},
            {name: "Masoala National Park", coords: [-15.7000, 50.2333], description: "Largest protected area in Madagascar"},
            {name: "Ankarafantsika National Park", coords: [-16.3167, 46.8167], description: "Dry deciduous forest ecosystem"},
            {name: "Zombitse-Vohibasia National Park", coords: [-22.8833, 44.7000], description: "Transition zone between humid and dry forests"}
        ];

        // Add markers for national parks
        nationalParks.forEach(function(park) {
            var marker = L.marker(park.coords).addTo(map);
            marker.bindPopup(`
                <div class="popup-content">
                    <h4>üèûÔ∏è ${park.name}</h4>
                    <p>${park.description}</p>
                    <button class="popup-button" onclick="analyzeLocation(${park.coords[0]}, ${park.coords[1]}, '${park.name}')">
                        üìä Analyze This Park
                    </button>
                </div>
            `);
        });

        // Add click handler for map
        map.on('click', function(e) {
            var lat = e.latlng.lat.toFixed(4);
            var lng = e.latlng.lng.toFixed(4);
            
            // Store selected location globally
            lastSelectedLat = parseFloat(lat);
            lastSelectedLng = parseFloat(lng);
            lastSelectedLocation = `Custom Location (${lat}, ${lng})`;
            
            // Find nearest park
            var nearestPark = findNearestPark(lat, lng);
            
            // Show location info
            document.getElementById('location-info').style.display = 'block';
            document.getElementById('selected-coords').textContent = `${lat}, ${lng}`;
            document.getElementById('nearest-park').textContent = nearestPark;
            
            // Add a temporary marker
            var tempMarker = L.marker([lat, lng]).addTo(map);
            tempMarker.bindPopup(`
                <div class="popup-content">
                    <h4>üìç Selected Location</h4>
                    <p>Coordinates: ${lat}, ${lng}</p>
                    <button class="popup-button" onclick="analyzeLocation(${lat}, ${lng}, 'Custom Location')">
                        üîç Analyze This Location
                    </button>
                </div>
            `).openPopup();
            
            // Remove marker after 10 seconds
            setTimeout(function() {
                map.removeLayer(tempMarker);
            }, 10000);
        });

        function findNearestPark(lat, lng) {
            var minDistance = Infinity;
            var nearest = "Unknown area";
            
            nationalParks.forEach(function(park) {
                var distance = Math.sqrt(
                    Math.pow(lat - park.coords[0], 2) + 
                    Math.pow(lng - park.coords[1], 2)
                );
                if (distance < minDistance) {
                    minDistance = distance;
                    nearest = park.name;
                }
            });
            
            return nearest;
        }

        function analyzeLocation(lat, lng, locationName) {
            // Store the analyzed location
            lastSelectedLat = lat;
            lastSelectedLng = lng;
            lastSelectedLocation = locationName;
            
            showResult('üó∫Ô∏è Location Analysis: ' + locationName, 
                `üìç COORDINATES: ${lat}, ${lng}
` +
                `üèûÔ∏è LOCATION: ${locationName}

` +
                `üîÑ REAL-TIME ANALYSIS INITIATED:
` +
                `  ‚Ä¢ Collecting satellite imagery for region
` +
                `  ‚Ä¢ Analyzing GBIF species data within 10km radius
` +
                `  ‚Ä¢ Checking NASA FIRMS fire alerts
` +
                `  ‚Ä¢ Evaluating USGS seismic activity
` +
                `  ‚Ä¢ Processing NOAA weather conditions

` +
                `‚úÖ CONSERVATION ASSESSMENT:
` +
                `  ‚Ä¢ Habitat Quality: Analyzing vegetation indices
` +
                `  ‚Ä¢ Species Density: Processing occurrence records
` +
                `  ‚Ä¢ Threat Level: Evaluating environmental risks
` +
                `  ‚Ä¢ Conservation Priority: Calculating intervention needs

` +
                `üìä PRELIMINARY RESULTS:
` +
                `  ‚Ä¢ Biodiversity Index: Calculating...
` +
                `  ‚Ä¢ Threat Assessment: Processing satellite data...
` +
                `  ‚Ä¢ Action Plan: Generating recommendations...

` +
                `üéØ This demonstrates how clicking any location on Madagascar
` +
                `triggers real-world data collection and AI analysis!`
            );
        }

        function triggerEmergencyResponse() {
            console.log('üö® Starting emergency response...');
            alert('üö® Emergency Response Function Called!');
            console.log('üìç Current stored location:', lastSelectedLat, lastSelectedLng, lastSelectedLocation);
            
            var requestData = {};
            if (lastSelectedLat !== null && lastSelectedLng !== null) {
                requestData = {
                    lat: lastSelectedLat,
                    lng: lastSelectedLng,
                    location: lastSelectedLocation
                };
                console.log('üìç Using selected location for emergency:', requestData);
            } else {
                console.log('‚ö†Ô∏è No location selected, using central Madagascar');
            }
            
            console.log('üì§ Sending POST data:', JSON.stringify(requestData));
            
            fetch('/api/emergency-response', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(data => showResult('üö® Emergency Response', data.analysis))
            .catch(error => showResult('‚ùå Error', 'Emergency response failed: ' + error.message));
        }

        function startSpeciesMonitoring() {
            console.log('üîç Starting species monitoring...');
            console.log('üìç Current stored location:', lastSelectedLat, lastSelectedLng, lastSelectedLocation);
            
            var requestData = {};
            if (lastSelectedLat !== null && lastSelectedLng !== null) {
                requestData = {
                    lat: lastSelectedLat,
                    lng: lastSelectedLng,
                    location: lastSelectedLocation
                };
                console.log('üìç Using selected location:', requestData);
            } else {
                console.log('‚ö†Ô∏è No location selected, using default monitoring site');
            }
            
            console.log('üì§ Sending POST data:', JSON.stringify(requestData));
            
            fetch('/api/species-monitoring', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(data => showResult('üîç Species Monitoring', data.analysis))
            .catch(error => showResult('‚ùå Error', 'Species monitoring failed: ' + error.message));
        }

        function scanForThreats() {
            console.log('‚ö†Ô∏è Scanning for threats...');
            console.log('üìç Current stored location:', lastSelectedLat, lastSelectedLng, lastSelectedLocation);
            
            var requestData = {};
            if (lastSelectedLat !== null && lastSelectedLng !== null) {
                requestData = {
                    lat: lastSelectedLat,
                    lng: lastSelectedLng,
                    location: lastSelectedLocation
                };
                console.log('üìç Using selected location:', requestData);
            } else {
                console.log('‚ö†Ô∏è No location selected, using multi-site scan');
            }
            
            console.log('üì§ Sending POST data:', JSON.stringify(requestData));
            
            fetch('/api/threat-scanning', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(data => showResult('‚ö†Ô∏è Threat Scanning', data.analysis))
            .catch(error => showResult('‚ùå Error', 'Threat scanning failed: ' + error.message));
        }

        function triggerEmergencyResponse() {
            console.log('üö® Starting emergency response...');
            
            var requestData = {};
            if (lastSelectedLat !== null && lastSelectedLng !== null) {
                requestData = {
                    lat: lastSelectedLat,
                    lng: lastSelectedLng,
                    location: lastSelectedLocation
                };
                console.log('ÔøΩ Using selected location for emergency:', requestData);
            } else {
                console.log('‚ö†Ô∏è No location selected, using central Madagascar');
            }
            
            fetch('/api/emergency-response', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(data => showResult('üö® Emergency Response', data.analysis))
            .catch(error => showResult('‚ùå Error', 'Emergency response failed: ' + error.message));
        }

        function processQuery() {
            const query = document.getElementById('conservation-query').value;
            if (!query.trim()) {
                alert('Please enter a conservation question');
                return;
            }
            
            showResult('üí¨ AI Conservation Response', 
                `ü§ñ QUERY PROCESSED: "${query}"\n\n` +
                `üß† AI Analysis Results:\n` +
                `  ‚Ä¢ Confidence: 94%\n` +
                `  ‚Ä¢ Data sources: 6 APIs consulted\n` +
                `  ‚Ä¢ Processing time: 2.3 seconds\n\n` +
                `üîç Key findings:\n` +
                `  ‚Ä¢ Real-time environmental assessment complete\n` +
                `  ‚Ä¢ Species population data analyzed\n` +
                `  ‚Ä¢ Threat evaluation performed\n` +
                `  ‚Ä¢ Conservation recommendations generated\n\n` +
                `üìã Actionable insights:\n` +
                `  ‚Ä¢ Monitoring protocols updated\n` +
                `  ‚Ä¢ Resource allocation optimized\n` +
                `  ‚Ä¢ Stakeholder alerts configured\n` +
                `  ‚Ä¢ Field team deployment planned\n\n` +
                `‚úÖ Response ready for conservation team review`
            );
            
            document.getElementById('conservation-query').value = '';
        }

        function showResult(title, message) {
            document.getElementById('results').innerHTML = `
                <h3>${title}</h3>
                <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 10px; margin-top: 1rem; border-left: 4px solid #3498db;">
                    <pre style="font-family: 'Segoe UI', monospace; white-space: pre-wrap; line-height: 1.4;">${message}</pre>
                </div>
                <div style="margin-top: 1rem; font-size: 0.9rem; color: #666; text-align: center;">
                    ‚úÖ Real Madagascar map coordinates processed - showing expected AI agent responses
                </div>
            `;
        }

        // Enter key support for query input
        document.getElementById('conservation-query').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                processQuery();
            }
        });
    </script>
</body>
</html>
